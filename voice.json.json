{"mode":"block","xmlText":"<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"ai_event_forever\" id=\"476+L,b7`_XJF_cC5H%/\" x=\"-362\" y=\"-463\"><statement name=\"ONSTART\"><block type=\"ai_mqtt_connect_default_servers\" id=\"C{k,w+{x#FcGBe#Az6QA\"><field name=\"SERVER\">io.adafruit.com:443</field><value name=\"USERNAME\"><shadow type=\"text\" id=\"L^m%*-POo9A5y*|G|MC4\"><field name=\"TEXT\">huynguyenk21ce</field></shadow></value><value name=\"KEY\"><shadow type=\"text\" id=\"|Peaec/NnH}N:hb7i2KN\"><field name=\"TEXT\">aio_Zhdh05qe1oHeqlN4IH72WGLNa3yz</field></shadow></value><next><block type=\"ai_speech_rec_event\" id=\"e6Q#PcO7Vk+Qp~RGTpXX\"><field name=\"language\">en-US</field><statement name=\"event_handler\"><block type=\"ai_display_background\" id=\"ZpMD%5DK:;7xILNm~weT\"><value name=\"COLOR\"><shadow type=\"colour_picker\" id=\"jfMcn]$|bhSvMgrUg{SD\"><field name=\"COLOUR\">#ffff00</field></shadow></value><next><block type=\"ai_display_text\" id=\"Jt^DDr[JtP!qV9`6%mvj\"><value name=\"TEXT\"><shadow type=\"text\" id=\"-:_8PZV;_T6E6m1U:0x,\"><field name=\"TEXT\">OK</field></shadow></value><value name=\"X\"><shadow type=\"math_number\" id=\"zt{XCbTM$3{~^](j?i}@\"><field name=\"NUM\">0</field></shadow></value><value name=\"Y\"><shadow type=\"math_number\" id=\"3ZX7]r^D[t!Pg--xtw-e\"><field name=\"NUM\">0</field></shadow></value><next><block type=\"controls_if\" id=\"n^tn4`A9:cssKj9M;()7\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"ZGRM;xlhv:4$)`o63K%b\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"*[r}.i8/[4HYku2yV)F7\"><value name=\"check_values\"><shadow type=\"text\" id=\"|#*v,(56R6_1c#2T0Cz*\"><field name=\"TEXT\">light</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"(ZTjW1|FaEN():kUL7N^\"><value name=\"check_values\"><shadow type=\"text\" id=\"ZD|tMo*O[EK|{=-,;=d=\"><field name=\"TEXT\">on</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"dcgatkO9M+%.{~{vJOP0\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\":,F5s.C%28JS@okk@DZ4\"><field name=\"TEXT\">1</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"y9Av`oFKFNhDV|*gk-r.\"><field name=\"TEXT\">led_button</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"yH{=At]tN4`{6#-aqcdq\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"I1Od6sUjry:!]Z~.m%K-\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"F:iwM^LHBC[K[)tXw91d\"><value name=\"check_values\"><shadow type=\"text\" id=\"hENjm;H?ur*)Ty:ygSxk\"><field name=\"TEXT\">light</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"}0SvVR?2m=+e`#7y3_yw\"><value name=\"check_values\"><shadow type=\"text\" id=\";v+$EY^9bNp3}P2P+.Kt\"><field name=\"TEXT\">off</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"k5rLwf[.Jyg8=ygw1imP\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"lEX0])pO[hg1)a9Dn$II\"><field name=\"TEXT\">0</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"YY/N1?L0/!PRH;ldOJg}\"><field name=\"TEXT\">led_button</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"0QeqNO(qbuUkqJJbX32R\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"g8])A=+E7$q2m]dAt9ob\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\";!F{f*:Xvl2StHD)C,Bh\"><value name=\"check_values\"><shadow type=\"text\" id=\"~g)1cq(oyHM2/utYrQ_6\"><field name=\"TEXT\">fan</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"Z^L[jBVDf0C{Sv`J!)(6\"><value name=\"check_values\"><shadow type=\"text\" id=\"fiA4T(+%)H_0w7fsG1w{\"><field name=\"TEXT\">three</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"vDMK0t=(NFze^4DO!vn_\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"+AKZM0GW,1$DN}T+8r~m\"><field name=\"TEXT\">3</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"lEcwQ2z1v#BM_+P0p/r@\"><field name=\"TEXT\">fan</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"[ko.VDR$tEMZwYoj|ZR5\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"uf=@L7$NZsV!X/m~s.P!\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"e_E156+(@U1@/B-r@?12\"><value name=\"check_values\"><shadow type=\"text\" id=\"K=*H]p9+a`rZHs^*C[e:\"><field name=\"TEXT\">fan</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\":9v.31_yc)FwIK[6*^m8\"><value name=\"check_values\"><shadow type=\"text\" id=\"MiI/XO=[rkVH?$M?Vj*L\"><field name=\"TEXT\">two</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"7Gc@%$oMY*w/a6!FRP%$\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"Rqw}XB`,*|?rTcrc[Fr}\"><field name=\"TEXT\">2</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"iD(bu+aA7=]!-c;J#DP#\"><field name=\"TEXT\">fan</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"f124,[ZDc)}jkLC8k|?.\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"{S_6kBUE9c*u4_1Sx6(Q\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"LfHVUI,q[@e5!m^i]FGL\"><value name=\"check_values\"><shadow type=\"text\" id=\"$(7;zZB8L-76*V-+a.Dl\"><field name=\"TEXT\">fan</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"E]PuqU[7JzDJV3L#4[Tv\"><value name=\"check_values\"><shadow type=\"text\" id=\"9-ZRf)QlVG(q03#o52P|\"><field name=\"TEXT\">one</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"x*^-i11H;z=R+((-]s_=\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"frc0Y;.X`cYvp~:=|BE1\"><field name=\"TEXT\">1</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"FuF5BB(lTecpTPi^.IuP\"><field name=\"TEXT\">fan</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"}tFy/_4hWs:EP`pTV;5+\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"?8D4^/Ont^kvG6,slRv;\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"8z/[#1EjQ.WN4e}j`3YW\"><value name=\"check_values\"><shadow type=\"text\" id=\"{*$WNFdagE|`.9^t~?TW\"><field name=\"TEXT\">fan</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"Mq}?adsS_[dXzsuJ6HDO\"><value name=\"check_values\"><shadow type=\"text\" id=\"=w#th@.R?yta`{*-.c$u\"><field name=\"TEXT\">off</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"FKk`wY33:]]v{hxjHiD$\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"RxDq}k2Hi0ourP-WE`Mb\"><field name=\"TEXT\">0</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"hD:n?;8amwqifsgf5[i~\"><field name=\"TEXT\">fan</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\"rN|[EX8f^7.];jQ0eEo1\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"x{EXok[qiq0/B66H8_q?\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"gHP,;maQ4j(c$,MJie:p\"><value name=\"check_values\"><shadow type=\"text\" id=\"Ri|E|Zb!{u#ndU2*vUdX\"><field name=\"TEXT\">open</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"!poUNi=(|fK*nt^Ruk2V\"><value name=\"check_values\"><shadow type=\"text\" id=\"0MnZZu9aLO3I(nCjb=0Z\"><field name=\"TEXT\">door</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"YZu(-CxnO}iF$9wL@++]\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"BjD;`u8`x~EBMf,bM,c/\"><field name=\"TEXT\">1</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\";|wYi8[[Q5*SxCpjJ#UN\"><field name=\"TEXT\">door_button</field></shadow></value></block></statement><next><block type=\"controls_if\" id=\":5gRq{*4Nlbf.YNCx7_~\"><value name=\"IF0\"><block type=\"logic_operation\" id=\"w{fg=(BGN#8_n0ZMimAe\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"ai_speech_rec_result_check\" id=\"H3_(NC5;%Yq)S!-[Fk6{\"><value name=\"check_values\"><shadow type=\"text\" id=\"cxX5:d~2n5[IbAD[]eFI\"><field name=\"TEXT\">close</field></shadow></value></block></value><value name=\"B\"><block type=\"ai_speech_rec_result_check\" id=\"D4}61hTW,(M}|_0p+.:y\"><value name=\"check_values\"><shadow type=\"text\" id=\"y*(MYzGy;7C(JEW2ZtT9\"><field name=\"TEXT\">door</field></shadow></value></block></value></block></value><statement name=\"DO0\"><block type=\"ai_mqtt_publish\" id=\"o.NihXaUAn+cbLS44uis\"><value name=\"MESSAGE\"><shadow type=\"text\" id=\"T)eM$k[)kOtRwbMul~6d\"><field name=\"TEXT\">0</field></shadow></value><value name=\"TOPIC\"><shadow type=\"text\" id=\"^-WL3[:eM%19`NI,awRS\"><field name=\"TEXT\">door_button</field></shadow></value></block></statement></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement><next><block type=\"ai_speech_rec_event_mode\" id=\"IA$AK:?Et^8Df%7zqReF\"><field name=\"mode\">true</field></block></next></block></next></block></statement></block></xml>","javascript":"function mqtt_check_connection() {\n  client.on(\"connect\", function () {\n    console.log(\"Connected\")\n  })\n}\n\nfunction mqtt_check_message() {\n  client.on(\"message\", (topic, message, packet) => {\n    console.log(\"Received Message: \" + message.toString() + \" on topic: \" + topic)\n  })\n}\n\nfunction mqtt_subscribe(topic) {\n  client.subscribe(options.username + /feeds/ + topic, { qos: 0 }, function (error, granted) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(`${granted[0].topic} was subscribed`)\n    }\n  })\n}\n\nfunction mqtt_publish(topic, msg) {\n  client.publish(options.username + /feeds/ + topic, msg, { qos: 0, retain: false }, function (error) {\n    if (error) {\n      console.log(error)\n    } else {\n      console.log(\"Published\")\n    }\n  })\n}\n\nfunction p5speechRecGotResult() {\n  background('#ffff00');\n  text('OK' , 0, 0);\n  if (new RegExp('light'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('on'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('led_button', '1')\n  }\n  if (new RegExp('light'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('off'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('led_button', '0')\n  }\n  if (new RegExp('fan'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('three'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('fan', '3')\n  }\n  if (new RegExp('fan'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('two'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('fan', '2')\n  }\n  if (new RegExp('fan'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('one'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('fan', '1')\n  }\n  if (new RegExp('fan'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('off'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('fan', '0')\n  }\n  if (new RegExp('open'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('door'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('door_button', '1')\n  }\n  if (new RegExp('close'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase()) && new RegExp('door'.split(\",\").map(function(item) {return item.trim();}).join(\"|\")).test(p5SpeechRec.resultString.toLowerCase())) {\n    mqtt_publish('door_button', '0')\n  }\n\n}\n\nfunction p5speechRecOnEnd() {\n  p5SpeechRec.start();\n}\n\nfunction sleep(s) {\n  ms = s * 1000\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n\nconst clientId = 'mqttjs_' + Math.random().toString(16).substr(2, 8);\n\nconst host = 'wss://io.adafruit.com:443'\n\nconst options = {clean: true,connectTimeout: 4000,clientId: clientId,username: 'huynguyenk21ce',password: 'aio_Zhdh05qe1oHeqlN4IH72WGLNa3yz'}\n\nconst client = mqtt.connect(host, options);\n\nlet p5SpeechRec = new p5.SpeechRec(\"en-US\", p5speechRecGotResult);\np5SpeechRec.onEnd = p5speechRecOnEnd;\np5SpeechRec.continuous = true; // do continuous recognition\n\nfunction preload() {\n\n}\n\nfunction setup() {\n  createCanvas(window.parent.document.getElementById('js-runner-container').offsetWidth-50, window.parent.document.getElementById('js-runner-container').offsetHeight-50);\n\n  mqtt_check_connection()\n  p5SpeechRec.start(); // start listening\n\n}\n\nfunction draw() {\n\n}\n","name":"ĐA-ĐN-HK232","extensions":[],"device":"ai"}